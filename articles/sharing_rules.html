<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sharing rules across packages • flir</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sharing rules across packages">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">flir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adding_rules.html">Adding new rules</a></li>
    <li><a class="dropdown-item" href="../articles/automatic_fixes.html">Automatic fixes</a></li>
    <li><a class="dropdown-item" href="../articles/sharing_rules.html">Sharing rules across packages</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">Tips and tricks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/etiennebacher/flir/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Sharing rules across packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/etiennebacher/flir/blob/main/vignettes/sharing_rules.Rmd" class="external-link"><code>vignettes/sharing_rules.Rmd</code></a></small>
      <div class="d-none name"><code>sharing_rules.Rmd</code></div>
    </div>

    
    
<p>Besides helping to detect a built-in list of bad patterns in R code,
<code>flir</code> can also be used to refactor code, for instance by
replacing the use of <a href="https://lifecycle.r-lib.org/articles/stages.html" class="external-link">deprecated or
superseded</a> functions. If you work on a project that uses
<code>dplyr</code>, you could for example <a href="https://flir.etiennebacher.com/articles/adding_rules">write your
own rules</a> to replace the use of <code>sample_n()</code> by
<code>slice_sample()</code> (as described in <a href="https://www.etiennebacher.com/posts/2025-05-23-refactoring-code-with-flir/" class="external-link">this
blog post</a>).</p>
<p>However, that puts the burden of writing such rules on the end user,
who is not necessarily familiar with all the changes in the package they
use. Therefore, <code>flir</code> provides a way for package developers
to define their own rules in the package so that anyone who uses it will
also have access to the same set of rules.</p>
<p>Let’s take an example with one of my packages: <a href="https://tidypolars.etiennebacher.com/" class="external-link"><code>tidypolars</code></a>.</p>
<div class="section level2">
<h2 id="state-of-the-package">State of the package<a class="anchor" aria-label="anchor" href="#state-of-the-package"></a>
</h2>
<p>At the time of writing, <code>tidypolars</code> (0.13.0) contains
several deprecated functions, such as <code>describe()</code> and
<code>describe_plan()</code>. Those functions should be replaced by
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code>explain(optimized = FALSE)</code>
respectively.</p>
</div>
<div class="section level2">
<h2 id="for-package-developers">For package developers<a class="anchor" aria-label="anchor" href="#for-package-developers"></a>
</h2>
<p>On the side of package developers (in this example, this is only me),
we can define some rules for <code>tidypolars</code> and store them in
<code>inst/flir/rules</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;I won’t spend time explaining each part of the file,
refer to the &lt;a href="https://flir.etiennebacher.com/articles/adding_rules"&gt;Adding
rules&lt;/a&gt; vignette for more details.&lt;/p&gt;'><sup>1</sup></a>.</p>
<p>First, I define a rule to detect the use of <code>describe()</code>
and replace it with <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> (you can use
<code><a href="../reference/export_new_rule.html">export_new_rule()</a></code> to create a placeholder YAML file):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">id</span><span class="kw">:</span><span class="at"> deprecated-describe</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span><span class="at"> r</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">severity</span><span class="kw">:</span><span class="at"> warning</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">rule</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">  </span><span class="fu">pattern</span><span class="kw">:</span><span class="at"> describe($$$ARGS)</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">fix</span><span class="kw">:</span><span class="at"> summary(~~ARGS~~)</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">message</span><span class="kw">:</span><span class="at"> In tidypolars, `describe()` is deprecated. Use `summary()` instead.</span></span></code></pre></div>
<p>Keep in mind that <code>flir</code> works mainly by using <em>code
patterns</em>, it doesn’t have information on the R environment.
Therefore, the rule above doesn’t know which package provides the
function and it would also replace <code>describe()</code> calls coming
from other packages.</p>
<p>I do the same with <code>describe_plan()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">id</span><span class="kw">:</span><span class="at"> deprecated-describe_plan</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span><span class="at"> r</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">severity</span><span class="kw">:</span><span class="at"> warning</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">rule</span><span class="kw">:</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="at">  </span><span class="fu">pattern</span><span class="kw">:</span><span class="at"> describe_plan($ARG)</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">fix</span><span class="kw">:</span><span class="at"> explain(~~ARG~~, optimized = FALSE)</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="fu">message</span><span class="kw">:</span><span class="at"> In tidypolars, `describe_plan()` is deprecated. Use `explain(optimized = FALSE)` instead.</span></span></code></pre></div>
<p>This is all that is needed from package developers. When users will
install the package, they will have access to those rules.</p>
<p><strong>Note:</strong> it is good practice to have a single name for
a family of rules and to use this name as filename. For instance, the
first rule has <code>id: deprecated-describe</code>, so I should name
the file <code>deprecated-describe.yml</code>. If you want to store
several rules related to this deprecation, you could name the other
rules <code>deprecated-describe_2</code>,
<code>deprecated-describe_3</code>, etc. and store them in the same
file, separated by <code>---</code>.</p>
<p>Overall, the only changes I had to do in <code>tidypolars</code>
are:</p>
<pre><code>inst
└── flir
    └── rules
        ├── deprecated-describe.yml
        └── deprecated-describe_plan.yml</code></pre>
</div>
<div class="section level2">
<h2 id="for-users">For users<a class="anchor" aria-label="anchor" href="#for-users"></a>
</h2>
<p>To use rules defined in other packages, you need to set up a
<code>flir</code> folder with <code><a href="../reference/setup_flir.html">setup_flir()</a></code>. This will
create the file <code>flir/config.yml</code> that we will modify to get
rules from other packages.</p>
<p>Once this is done, you can add a field <code>from-package</code> and
list the packages from which you want to import the rules. For instance,
to benefit from the rules defined above, we can do:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">from-package</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> tidypolars</span></span></code></pre></div>
<p>and that’s it! From now on, all calls to <code>lint_*()</code> or
<code>fix_*()</code> on the project will also use the rules stored in
<code>tidypolars</code>. Note that those rules are bundled with the
package, meaning that if the package developers change or remove some
rules and you update the package, the rules you will have access to will
be different.</p>
<p>As before, you can also list rules to exclude in the
<code>exclude</code> field of <code>flir/config.yml</code> but you will
need to prefix them with <code>from-&lt;pkgname&gt;-</code>. For
instance, to ignore the rule about the deprecation of
<code>describe()</code>, you can set:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">exclude</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> from-tidypolars-deprecated-describe</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.etiennebacher.com" class="external-link">Etienne Bacher</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
